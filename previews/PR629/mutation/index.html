<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Mutation · BioMakie.jl</title><meta name="title" content="Mutation · BioMakie.jl"/><meta property="og:title" content="Mutation · BioMakie.jl"/><meta property="twitter:title" content="Mutation · BioMakie.jl"/><meta name="description" content="Documentation for BioMakie.jl."/><meta property="og:description" content="Documentation for BioMakie.jl."/><meta property="twitter:description" content="Documentation for BioMakie.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">BioMakie.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../msaselection/">MSA Selection</a></li><li><a class="tocitem" href="../alphashape/">Alpha Shape</a></li><li><a class="tocitem" href="../dbinfo/">Database Info</a></li><li class="is-active"><a class="tocitem" href>Mutation</a><ul class="internal"><li><a class="tocitem" href="#Copy-pastable-code"><span>Copy-pastable code</span></a></li><li><a class="tocitem" href="#Load-BioMakie-and-ProtoSyn"><span>Load BioMakie and ProtoSyn</span></a></li><li><a class="tocitem" href="#Prepare-the-structure"><span>Prepare the structure</span></a></li><li><a class="tocitem" href="#Get-plotting-data-and-plot-it"><span>Get plotting data and plot it</span></a></li><li><a class="tocitem" href="#Prepare-the-structure-2"><span>Prepare the structure</span></a></li><li><a class="tocitem" href="#Mutate-the-structure"><span>Mutate the structure</span></a></li></ul></li><li><a class="tocitem" href="../API/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Mutation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Mutation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/BioJulia/BioMakie.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/kool7d/BioMakie.jl/blob/dev/docs/src/mutation.md" title="View source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="ProtoSyn-Protein-Mutation"><a class="docs-heading-anchor" href="#ProtoSyn-Protein-Mutation">ProtoSyn Protein Mutation</a><a id="ProtoSyn-Protein-Mutation-1"></a><a class="docs-heading-anchor-permalink" href="#ProtoSyn-Protein-Mutation" title="Permalink"></a></h1><p>In this demo we can use ProtoSyn.jl to mutate amino acids. Different rotamers can be selected for the mutated residue. To use ProtoSyn here you currently have to use a workaround. The <code>getprotosyn()</code> function downloads the source code, then you can <code>include</code> it. In the future hopefully it will be built in.</p><h2 id="Copy-pastable-code"><a class="docs-heading-anchor" href="#Copy-pastable-code">Copy-pastable code</a><a id="Copy-pastable-code-1"></a><a class="docs-heading-anchor-permalink" href="#Copy-pastable-code" title="Permalink"></a></h2><pre><code class="language-julia hljs">using BioMakie
using GLMakie
using BioStructures
BioMakie.getprotosyn()
include(&quot;../protosyn.jl&quot;)
struc = retrievepdb(&quot;2vb1&quot;)
chn = collectresidues(struc[1][&quot;A&quot;], standardselector)
writepdb(&quot;2vb1x.pdb&quot;, chn)
rot_lib = ProtoSyn.Peptides.load_dunbrack()
res_lib = ProtoSyn.load_grammar_from_file(ProtoSyn.resource_dir*&quot;/Peptides/grammars.yml&quot;, &quot;default&quot;)
pose = ProtoSyn.Peptides.load(&quot;2vb1x.pdb&quot;; bonds_by_distance=true) |&gt; Observable
ProtoSyn.Peptides.cap!(pose[])
ProtoSyn.Peptides.assign_default_atom_names!(pose[])
ProtoSyn.sort_atoms_by_graph!(pose[])
ProtoSyn.Peptides.Calculators.Electrostatics.assign_default_charges!(pose[], res_lib)
pdata = plottingdata(pose)
fig = Figure(resolution = (985,700))
layout = fig[1,1] = GridLayout(11,7)
selected = @lift pdata[:resids][][$(pdata[:selected])] |&gt; unique
selection_text = lift(selected) do sel
    if length(sel) == 0
        return &quot;&quot;
    else
        return &quot;$(string(pose[].graph[1][sel[1]]))&quot;
    end
end
_plotstruc!(layout[1:10,1:5], pdata; resolution = (600,700))
title = Label(layout[1,6:7]; text = &quot;Mutate Residue&quot;, fontsize = 30)
selection_label = Label(layout[2,6:7]; text = &quot;Selection:&quot;, fontsize = 20)
vselection = Label(layout[3,6:7]; text = selection_text, fontsize = 16)
clear_button = Button(layout[4,6:7]; label = &quot;Clear selection&quot;,
                    buttoncolor = :pink, fontsize = 18,
                    width = 140, height = 50)
mutation_label = Label(layout[5,6:7]; text = &quot;Mutate selection to:&quot;, fontsize = 20)
mutate_menu = Menu(layout[6,6:7]; options = BioMakie.res3letters[1:20],
                        cell_color_active = to_color(:lightblue),
                        cell_color_hover = to_color(:lightgreen),
                        selection_cell_color_inactive = to_color(:lightblue)
)
mutate_button = Button(layout[7,6:7]; label = &quot;Mutate!&quot;,
                    buttoncolor = :lightgreen, fontsize = 18, width = 80, height = 50
)
rotamer = Observable(1)
rotamer_label = Label(layout[8:9,6]; text = &quot;Change rotamer:&quot;, fontsize = 20)
rotamer_button1 = Button(layout[8,7]; label = &quot;ꜛ&quot;,
                    buttoncolor = :lightgreen, fontsize = 40,
                    tellwidth = false, width = 70, height = 40
)
rotamer_button2 = Button(layout[9,7]; label = &quot;ꜜ&quot;,
                    buttoncolor = :lightgreen, fontsize = 40,
                    tellwidth = false, width = 70, height = 40
)
on(clear_button.clicks) do s
    pdata[:selected][] = Vector{Bool}(undef,length(pdata[:selected][])) .= false
end
on(mutate_button.clicks) do s
    selection_text[] = &quot;$(string(pose[].graph[1][selected[][1]]))&quot;
    mutletter = BioMakie.resletterdict[mutate_menu.selection[]]
    ProtoSyn.Peptides.mutate!(pose[], pose[].graph[1][selected[][1]], res_lib, [mutletter])
    fixpose!(pose)
end
on(rotamer_button1.clicks) do s
    if length(selected[]) == 0
        println(&quot;No selection&quot;)
    else
        phi = ProtoSyn.getdihedral(pose[].state, ProtoSyn.Peptides.phi(pose[].graph[1][selected[][1]]))
        psi = ProtoSyn.getdihedral(pose[].state, ProtoSyn.Peptides.psi(pose[].graph[1][selected[][1]]))
        stack = rot_lib[&quot;$(pose[].graph[1][selected[][1]].name)&quot;][phi, psi]
        nrotamers = length(stack.rotamers)
        if rotamer[] &lt; nrotamers
            rotamer[] = rotamer[] + 1
        end
        ProtoSyn.Peptides.apply!(pose[].state, stack[rotamer[]], pose[].graph[1][selected[][1]])
        fixpose!(pose)
    end
end
on(rotamer_button2.clicks) do s
    if length(selected[]) == 0
        println(&quot;No selection&quot;)
    else
        phi = ProtoSyn.getdihedral(pose[].state, ProtoSyn.Peptides.phi(pose[].graph[1][selected[][1]]))
        psi = ProtoSyn.getdihedral(pose[].state, ProtoSyn.Peptides.psi(pose[].graph[1][selected[][1]]))
        stack = rot_lib[&quot;$(pose[].graph[1][selected[][1]].name)&quot;][phi, psi]
        nrotamers = length(stack.rotamers)
        if rotamer[] &gt; nrotamers
            rotamer[] = rotamer[] - 1
        end
        ProtoSyn.Peptides.apply!(pose[].state, stack[rotamer[]], pose[].graph[1][selected[][1]])
        fixpose!(pose)
    end
end</code></pre><p><img src="../assets/mutation.gif" alt="mutation"/></p><h2 id="Load-BioMakie-and-ProtoSyn"><a class="docs-heading-anchor" href="#Load-BioMakie-and-ProtoSyn">Load BioMakie and ProtoSyn</a><a id="Load-BioMakie-and-ProtoSyn-1"></a><a class="docs-heading-anchor-permalink" href="#Load-BioMakie-and-ProtoSyn" title="Permalink"></a></h2><p>Download the protosyn source code from the src directory of BioMakie and <code>include</code> it. This should install a few packages (SplitApplyCombine, Colors, Meshes, GeometryBasics, OrderedCollections, Distances) and then import ProtoSyn.</p><pre><code class="language-julia hljs">using BioMakie
using GLMakie

BioMakie.getprotosyn()
include(&quot;../protosyn.jl&quot;)</code></pre><h2 id="Prepare-the-structure"><a class="docs-heading-anchor" href="#Prepare-the-structure">Prepare the structure</a><a id="Prepare-the-structure-1"></a><a class="docs-heading-anchor-permalink" href="#Prepare-the-structure" title="Permalink"></a></h2><p>To simplify things, we will load a structure with BioStructures and save chain &quot;A&quot; as a PDB file. Then we will load the PDB file with ProtoSyn.</p><pre><code class="language-julia hljs">using BioStructures
struc = retrievepdb(&quot;2vb1&quot;)
chn = collectresidues(struc[1][&quot;A&quot;], standardselector)
writepdb(&quot;2vb1x.pdb&quot;, chn)

pose = ProtoSyn.Peptides.load(&quot;2vb1x.pdb&quot;; bonds_by_distance=true) |&gt; Observable</code></pre><h2 id="Get-plotting-data-and-plot-it"><a class="docs-heading-anchor" href="#Get-plotting-data-and-plot-it">Get plotting data and plot it</a><a id="Get-plotting-data-and-plot-it-1"></a><a class="docs-heading-anchor-permalink" href="#Get-plotting-data-and-plot-it" title="Permalink"></a></h2><pre><code class="language-julia hljs">pdata = plottingdata(pose)
fig = Figure()
_plotstruc!(fig, pdata)</code></pre><p><img src="../assets/wildtypearg.png" alt="wildtypearg"/></p><h2 id="Prepare-the-structure-2"><a class="docs-heading-anchor" href="#Prepare-the-structure-2">Prepare the structure</a><a class="docs-heading-anchor-permalink" href="#Prepare-the-structure-2" title="Permalink"></a></h2><p>We can use <code>diagnose</code> to get an idea of what is missing and of inconsistencies in the structure.</p><pre><code class="language-julia hljs">ProtoSyn.Peptides.diagnose(pose[])</code></pre><p>We have several issues, including charges, naming, and caps, which are the terminal hydrogens. We can use the following functions to address these issues. First we load the library of amino acids, to get the Peptide/protein-specific data, instead of the default generic data.</p><pre><code class="language-julia hljs">res_lib = ProtoSyn.load_grammar_from_file(ProtoSyn.resource_dir*&quot;/Peptides/grammars.yml&quot;, &quot;default&quot;)
ProtoSyn.Peptides.cap!(pose[])
ProtoSyn.Peptides.assign_default_atom_names!(pose[])
ProtoSyn.sort_atoms_by_graph!(pose[])
ProtoSyn.Peptides.Calculators.Electrostatics.assign_default_charges!(pose[], res_lib)

ProtoSyn.Peptides.diagnose(pose[])</code></pre><p>Now the issues should say <code>OK</code>, except for the atom-level graph. We can ignore this for now. This <code>fixpose!</code> function below may be convenient for syncing and correcting the structure after making changes. Using <code>pose[] = pose[]</code> can force Makie to update the pose/figure.</p><pre><code class="language-julia hljs">function fixpose!(pose::Observable; res_lib=ProtoSyn.load_grammar_from_file(ProtoSyn.resource_dir*&quot;/Peptides/grammars.yml&quot;, &quot;default&quot;))
    ProtoSyn.Peptides.cap!(pose[])
    ProtoSyn.Peptides.assign_default_atom_names!(pose[])
    ProtoSyn.sort_atoms_by_graph!(pose[])
    ProtoSyn.Calculators.Electrostatics.assign_default_charges!(pose[],res_lib)
    ProtoSyn.Peptides.sync!(pose[])
    pose[] = pose[]
end</code></pre><h2 id="Mutate-the-structure"><a class="docs-heading-anchor" href="#Mutate-the-structure">Mutate the structure</a><a id="Mutate-the-structure-1"></a><a class="docs-heading-anchor-permalink" href="#Mutate-the-structure" title="Permalink"></a></h2><p>Get information about a residue. In this example we will use residue 128 because it is easy to find on the structure. The long side chain of this arginine extends outward the furthest.</p><pre><code class="language-julia hljs">pose[].graph[1][128]</code></pre><p>Next lets try mutating it to tyrosine. We can use the <code>mutate!</code> function to do this. Combine it with <code>fixpose!</code> to get the updated structure. You should see the side chain change into the phenol ring of tyrosine.</p><pre><code class="language-julia hljs">ProtoSyn.Peptides.mutate!(pose[], pose[].graph[1][128], res_lib, [&quot;Y&quot;])
fixpose!(pose)</code></pre><p><img src="../assets/mutanttyr.png" alt="mutanttyr"/></p><p>To choose different rotamers/orientations, we can use the rotamer library. ProtoSyn provides a stack of the most likely rotamers based on the dihedral angles of the residue.</p><pre><code class="language-julia hljs">rot_lib = ProtoSyn.Peptides.load_dunbrack()
phi = ProtoSyn.getdihedral(pose[].state, ProtoSyn.Peptides.phi(pose[].graph[1][128]))
psi = ProtoSyn.getdihedral(pose[].state, ProtoSyn.Peptides.psi(pose[].graph[1][128]))
stack = rot_lib[&quot;TYR&quot;][phi, psi]

ProtoSyn.Peptides.apply!(pose[].state, stack[3], pose[].graph[1][128])
fixpose!(pose)</code></pre><p><img src="../assets/mutanttyrrotamer.png" alt="mutanttyrrotamer"/></p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../dbinfo/">« Database Info</a><a class="docs-footer-nextpage" href="../API/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Saturday 28 December 2024 22:07">Saturday 28 December 2024</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
